```
backend/
|-- app/
|      |-- views/           # è§†å›¾å‡½æ•°
|          |-- auth.py      # åŒ…å«ç™»å½•å’Œæ³¨é”€çš„è§†å›¾å‡½æ•°  
|          |-- data.py      # åŒ…å«æ•°æ®æ”¶é›†ç›¸å…³çš„è§†å›¾å‡½æ•°ï¼Œå¼ƒç”¨
|          |-- admin.py     # åŒ…å«è®¾å¤‡ç®¡ç†ç›¸å…³çš„è§†å›¾å‡½æ•°
|          |-- control.py   # å¤„ç†å®¢æˆ·ç«¯æŽ§åˆ¶æ“ä½œ
|          |-- query.py     # åŒ…å«æ•°æ®æŸ¥è¯¢ç›¸å…³çš„è§†å›¾å‡½æ•°
|          |-- room.py      # åŒ…å«æˆ¿é—´ç›¸å…³çš„è§†å›¾å‡½æ•°
|      |-- config.py        # é…ç½®æ–‡ä»¶
|      |-- run.py           # æž„å»ºå®žä¾‹
|      |-- models.py        # æ•°æ®åº“æ¨¡åž‹
|      |-- utils.py         # å­˜å‚¨è¾…åŠ©å‡½æ•°å’Œå·¥å…·å‡½æ•°
|-- data/
|      |-- Bupt.db          # Sqlite æ•°æ®åº“
|-- manager.py          	# è¿è¡Œæ–‡ä»¶
|-- README.MD        
```
## åŽç«¯éƒ¨åˆ†äº¤äº’ä½¿ç”¨è¯´æ˜Žæ–‡æ¡£

> Written by @Conqueror712 ðŸ¤—

è¦æµ‹è¯•routeæ˜¯å¦å¯ç”¨ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€æ­¥çš„å¼€å‘ä¸Žä½¿ç”¨ï¼Œè¯·ç¡®ä¿æ‹¥æœ‰ä»¥ä¸‹æµ‹è¯•çŽ¯å¢ƒï¼š

> æ³¨ï¼šå¹¶éžä¸€å®šè¦ç”¨è¿™äº›çŽ¯å¢ƒæ‰èƒ½è¿›è¡Œæµ‹è¯•ï¼Œä»…ä¾›å‚è€ƒ

- OS: Windows 10/11
- APIæµ‹è¯•å·¥å…·: Apifox/Postman
- PythonçŽ¯å¢ƒ: requirements.txtä¸­æ‰€éœ€çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åº“
- Project src: git clone git@github.com:Cloud0310/BUPT-2023-SE-Homework.git
- DBMS: SQLite

### 1. æ‰“å¼€SQLiteå¹¶åˆ›å»ºæ•°æ®åº“

è¯·ç¡®ä¿ä½ æ­£ç¡®å®‰è£…äº†SQLiteå¹¶æ·»åŠ äº†ç›¸åº”çš„çŽ¯å¢ƒå˜é‡ï¼ŒéšåŽæ‰“å¼€ä¸€ä¸ªPowerShellè¾“å…¥å‘½ä»¤ä»¥æ‰“å¼€SQLite:

```
sqlite3
```

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼ˆæ–¹æ³•ä¸å”¯ä¸€ï¼Œè¿™ç§æ–¹æ³•å¦‚æžœ`xxx.db`å­˜åœ¨åˆ™ç›´æŽ¥ä¼šæ‰“å¼€ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºå®ƒï¼‰:

```
sqlite>.open buptse.db
```

> æ³¨æ„ï¼Œè¿™æ¡å‘½ä»¤å‰é¢çš„`sqlite>`ä¸éœ€è¦æˆ‘ä»¬è¾“å…¥ï¼Œå¦å¤–ï¼Œè¿™ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºï¼Œè¯·ç¡®ä¿ä½ çš„è·¯å¾„æ­£ç¡®ï¼Œåœ¨æœ¬é¡¹ç›®ä¸­ï¼Œé»˜è®¤åœ¨ç›¸å¯¹è·¯å¾„`/backend/db/`ä¸‹

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸåˆ›å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨æ–‡ä»¶å¤¹ä¸­ç›´æŽ¥æŸ¥çœ‹:

```
>sqlite>.databases
```

å¦å¤–ï¼Œå¦‚æžœä½ å‘çŽ°ä½ çš„terminalä¸­çš„è¾“å‡ºå¹¶ä¸ç›´è§‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¼€å¯æ ¼å¼åŒ–è¾“å‡º:

```
sqlite>.header on
sqlite>.mode column
sqlite>.timer on
```

> è™½ç„¶ç¬”è€…å¹¶æ²¡æœ‰æˆåŠŸï¼Œä½†è²Œä¼¼æ˜¯è¿™æ ·ä¿®æ”¹ï¼ˆç¬‘ï¼‰

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ä½ çš„SQLiteé…ç½®:

```
sqlite>.show
```

å¦‚æžœä½ å€¦äº†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é€€å‡ºSQLiteï¼Œè¯·å°½é‡ä¸è¦æš´åŠ›é€€å‡º:

```
sqlite>.quit
```

å½“ä½ æƒ³å¯¼å‡ºå®Œæ•´çš„`.sql`æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:

```
sqlite3>xxx.db .dump > xxx.sql
```

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”±`.sql`æ¢å¤æˆ`.db`:

```
sqlite3>xxx.db < xxx.sql
```

> æ³¨ï¼šè¿™é‡Œå¯¼å‡ºçš„`.sql`æ–‡ä»¶çš„ç¼–ç æ ¼å¼ä¸ºASCII

### 2. åˆå§‹åŒ–æ•°æ®åº“é…ç½®

> æ³¨ï¼šè¿™é‡Œçš„è¡¨ç»“æž„ä¸ä¸€å®šæ˜¯æœ€ç»ˆç‰ˆçš„è¡¨ç»“æž„ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºŽè¿›è¡Œæµ‹è¯•

é¦–å…ˆå½“ç„¶æ˜¯è¦æ˜Žç¡®æˆ‘ä»¬éœ€è¦å‡ å¼ è¡¨ï¼Œæ¯å¼ è¡¨é‡Œæœ‰ä»€ä¹ˆï¼Œå¤§è‡´å¦‚ä¸‹:

- recordsè¡¨ï¼š
    - idï¼šTEXTç±»åž‹ï¼Œä¸»é”®ï¼Œè®°å½•çš„å”¯ä¸€æ ‡è¯†
    - roomï¼šTEXTç±»åž‹ï¼Œè¡¨ç¤ºæˆ¿é—´å·
- devicesè¡¨ï¼š
    - roomï¼šTEXTç±»åž‹ï¼Œè¡¨ç¤ºæˆ¿é—´å·
    - public_keyï¼šTEXTç±»åž‹ï¼Œè¡¨ç¤ºè®¾å¤‡çš„å…¬é’¥
        check_insè¡¨ï¼š
    - roomï¼šTEXTç±»åž‹ï¼Œè¡¨ç¤ºæˆ¿é—´å·
    - check_in_timeï¼šå­˜å‚¨å…¥ä½æ—¶é—´çš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„æ—¶é—´è¡¨ç¤ºæ–¹å¼
    - check_out_timeï¼šå­˜å‚¨é€€æˆ¿æ—¶é—´çš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„æ—¶é—´è¡¨ç¤ºæ–¹å¼
    - timestampï¼šå­˜å‚¨æ—¶é—´æˆ³çš„å­—æ®µï¼Œç”¨äºŽè®°å½•æ“ä½œå‘ç”Ÿçš„æ—¶é—´
- expensesè¡¨ï¼ˆç»Ÿè®¡ç”¨ï¼‰ï¼š
    - dateï¼šå­˜å‚¨æ—¥æœŸçš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„æ—¥æœŸè¡¨ç¤ºæ–¹å¼
    - amountï¼šå­˜å‚¨é‡‘é¢çš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„é‡‘é¢è¡¨ç¤ºæ–¹å¼
- incomeè¡¨ï¼ˆç»Ÿè®¡ç”¨ï¼‰ï¼š
    - dateï¼šå­˜å‚¨æ—¥æœŸçš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„æ—¥æœŸè¡¨ç¤ºæ–¹å¼
    - amountï¼šå­˜å‚¨é‡‘é¢çš„å­—æ®µï¼Œå…·ä½“ç±»åž‹å–å†³äºŽä½ å¸Œæœ›ä½¿ç”¨çš„é‡‘é¢è¡¨ç¤ºæ–¹å¼

æ˜Žç¡®äº†éœ€æ±‚ï¼ŒçŽ°åœ¨æˆ‘ä»¬å°±æ¥ç€æ‰‹åˆ›å»ºä¸€ä¸‹ï¼Œ`CREATE TABLE`è¯­å¥çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹:

```
CREATE TABLE database_name.table_name(
   column1 datatype  PRIMARY KEY(one or more columns),
   column2 datatype,
   column3 datatype,
   .....
   columnN datatype,
);
```

> æ³¨ï¼š`database_name`åœ¨ä½ é€‰å®šå¥½æ•°æ®åº“çš„æ—¶å€™å¯ä»¥çœç•¥

å¯¹äºŽæˆ‘ä»¬çš„é¡¹ç›®è€Œè¨€ï¼Œå¯ä»¥åˆ›å»ºè¿™æ ·çš„è¡¨ï¼ˆè™½ç„¶å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†è¿˜æ˜¯åŒºåˆ†ä¸ºå¥½ï¼‰:

```
sqlite> CREATE TABLE records(
   id INT PRIMARY KEY     NOT NULL,
   room           TEXT    NOT NULL
);
```

> æ³¨ï¼š`NOT NULL`çš„çº¦æŸè¡¨ç¤ºåœ¨è¡¨ä¸­åˆ›å»ºçºªå½•æ—¶è¿™äº›å­—æ®µä¸èƒ½ä¸º`NULL`

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹è¡¨æ˜¯å¦è¢«æˆåŠŸåˆ›å»º:

```
sqlite>.tables
```

æ›´è¿›ä¸€æ­¥åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¡¨çš„å®Œæ•´ä¿¡æ¯:

```
sqlite>.schema table_name
```

> æœªå®Œå¾…ç»­...